<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Deploying a Python Flask application to production â€” Eric's Blog</title>
	<meta name="description" content="Title: Deploying a Python Flask application to production; Date: 2017-05-28; Author: Eric Daoud">
	<meta name="author" content="Eric Daoud">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="https://ericdaat.github.io/theme/html5.js"></script>
		<![endif]-->
	<link href="https://ericdaat.github.io/theme/css/ipython.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="https://ericdaat.github.io/theme/css/local.css" rel="stylesheet">
	<link href="https://ericdaat.github.io/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<div class="page-header">
		<h1><a href="https://ericdaat.github.io/">Eric's Blog</a>
			<br><small>Jr. Data Scientist</small></h1>	</div>
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Deploying a Python Flask application to production</h1>
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<h4 itemprop="name">Eric Daoud</h4>
		</span>
		<time datetime="2017-05-28T10:20:00+02:00" itemprop="datePublished">Sun 28 May 2017</time>
	</div>
	<div>
		Category:
		<span itemprop="articleSection">
			<a href="https://ericdaat.github.io/category/programming.html" rel="category">Programming</a>
		</span>
	</div>
 
	<div>
		Tags:
		<span itemprop="keywords">
			<a href="https://ericdaat.github.io/tag/python.html" rel="tag">python</a>
		</span>
		<span itemprop="keywords">
			<a href="https://ericdaat.github.io/tag/code.html" rel="tag">code</a>
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>In this post we are going to see how we can efficiently deploy a web application powered by Flask (a Python framework) to production. We won't code a complex application, actually we will just stick to the Flask Hello World example.</p>
<h2>Basic Flask application</h2>
<p>If you've never heard of Flask before, I recommend you to visit its <a href="http://flask.pocoo.org/">website</a> and read about it.</p>
<p>To create a Hello World application in Flask, just write the following code in a file called <code>application.py</code>.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello, World!&quot;</span>
</pre></div>


<p>And then run the application with this code in a <code>main.py</code> file.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">application</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">application</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">application</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<p>Now run <code>python main.py</code> and your app should be visible in your browser at <code>localhost:5000</code>.</p>
<h2>WSGI server</h2>
<p>So far we have a working application, but it won't be enough to serve a production environment. Python applications can't be directly deployed in a webserver, because python is not a web compatible language like Javascript or PHP for instance. Hence, we need an additional layer: a WSGI server.</p>
<p>There are various WSGI servers on the market, <a href="http://gunicorn.org/">Gunicorn</a> is a popular choice but my favorite is <a href="https://uwsgi-docs.readthedocs.io/en/latest/">uWSGI</a>.</p>
<h3>Getting started</h3>
<p>You can install uWSGI with pip: <code>pip install uwsgi</code>. Once you have it installed, you can run our previous python application within a WSGI webserver by simply doing <code>uwsgi main.py</code>. You can pass many arguments to the <code>uwsgi</code> command, but it is often prefered to have them all in a single configuration file. uWSGI can just do that, let's create a <code>uwsgi.ini</code> configuration file that looks like this:</p>
<div class="highlight"><pre><span></span>[uwsgi]
wsgi-file = main.py
master = true
processes = 2
http = 0.0.0.0:9000
vacuum = true
die-on-term = true
</pre></div>


<p>Now we can run the app with <code>uwsgi wsgi.ini</code>. With such configuration, our Flask application will be hosted on 2 processes. This is an arbiratry number we set, but you can increase it either manually or automatically if you need to handle more trafic. The server will respond on <code>0.0.0.0:9000</code>, which means that every client on the local network will be able to access the app on port 9000 using the HTTP protocol. Check that you can still see your app at <code>localhost:9000</code>. You should also be able to see it from another device connected to the same network at <code>&lt;your-ip&gt;:9000</code>.</p>
<h2>Putting uWSGI behing NGINX reverse proxy</h2>
<p>I like to run uWSGI behind a reverse proxy such as NGINX. This is fairly easy with this configuration file:</p>
<div class="highlight"><pre><span></span>upstream backend {
    least_conn;
    server localhost:9000;
}

server {
    listen 80;
    location {
        uwsgi_pass backend;
        include uwsgi_params;
    }
}
</pre></div>


<p>With such a configuration, NGINX listens on port 80 and redirects the requests to <code>localhost:9000</code> which is our uwsgi server. Be careful though, since we use <code>uwsgi_pass</code> command, the uwsgi application must run in a socket and not on http. Just change your <code>uwsgi.ini</code> configuration file accordingly:</p>
<div class="highlight"><pre><span></span>[uwsgi]
wsgi-file = main.py
master = true
processes = 2
socket = 0.0.0.0:9000
vacuum = true
die-on-term = true
</pre></div>


<p>Now, just run the application with <code>uwsgi wsgi.ini</code> and it will launch the
application with the configuration you just wrote. You can then write a startup
script with <em>upstart</em> or <em>systemd</em> to make your application run in the
background and easily start/stop it.</p>
<p>In another post, I'll cover how to run all this with <a href="https://www.docker.com/">Docker</a>, as it is what I tend to use now to deploy apps in production. </p></div>
	<hr>
	<h2>Comments</h2>
</div>
		</div>
	</div> 	<!-- <hr> -->
</div> <!-- /container -->
<footer class="aw-footer bg-danger">
	<div class="container"> <!-- footer -->
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-3">
						<h4>Navigation</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://ericdaat.github.io">Eric's Blog</a></li>
							<li><a href="https://ericdaat.github.io//archives.html"><i class="fa fa-Archives "></i> Archives</a></li>
							<li><a href="https://ericdaat.github.io//categories.html"><i class="fa fa-Categories "></i> Categories</a></li>
							<li><a href="https://ericdaat.github.io//tags.html"><i class="fa fa-Tags "></i> Tags</a></li>
							<li><a href="https://ericdaat.github.io/pages/about-me.html"><i class="fa fa-About me "></i> About me</a></li>
							<li><a href="https://ericdaat.github.io/feeds/all.atom.xml" type="application/atom+xml"><i class="fa fa-rss "></i> atom</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Author</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://github.com/ericdaat">Github</a></li>
							<li><a href="https://twitter.com/ericdaoud">Twitter</a></li>
							<li><a href="https://www.youtube.com/user/ericmusic13">Youtube</a></li>
							<li><a href="https://www.linkedin.com/in/ericdaoud/">Linkedin</a></li>
							<li><a href="https://500px.com/ericda">500px</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Categories</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://ericdaat.github.io/category/photography.html">Photography (1)</a></li>
							<li><a href="https://ericdaat.github.io/category/programming.html">Programming (3)</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; Eric Daoud 2016</p>
			<p>Powered by Pelican</p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
</body>
</html>