<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>From KSHE 95 radio website to Spotify Playlist â€” Eric's Blog</title>
	<meta name="description" content="Title: From KSHE 95 radio website to Spotify Playlist; Date: 2017-08-16; Author: Eric Daoud">
	<meta name="author" content="Eric Daoud">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="https://ericdaat.github.io/theme/html5.js"></script>
		<![endif]-->
	<link href="https://ericdaat.github.io/theme/css/ipython.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="https://ericdaat.github.io/theme/css/local.css" rel="stylesheet">
	<link href="https://ericdaat.github.io/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<div class="page-header">
		<h1><a href="https://ericdaat.github.io/">Eric's Blog</a>
			<br><small>Data Scientist, Full Stack Developer</small></h1>	</div>
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">From KSHE 95 radio website to Spotify Playlist</h1>
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<h4 itemprop="name">Eric Daoud</h4>
		</span>
		<time datetime="2017-08-16T10:20:00+02:00" itemprop="datePublished">Wed 16 August 2017</time>
	</div>
	<div>
		Category:
		<span itemprop="articleSection">
			<a href="https://ericdaat.github.io/category/programming.html" rel="category">Programming</a>
		</span>
	</div>
	<div>
		Tags:
		<span itemprop="keywords">
			<a href="https://ericdaat.github.io/tag/python.html" rel="tag">python</a>
		</span>
		<span itemprop="keywords">
			<a href="https://ericdaat.github.io/tag/code.html" rel="tag">code</a>
		</span>
		<span itemprop="keywords">
			<a href="https://ericdaat.github.io/tag/spotify.html" rel="tag">spotify</a>
		</span>
		<span itemprop="keywords">
			<a href="https://ericdaat.github.io/tag/music.html" rel="tag">music</a>
		</span>
		<span itemprop="keywords">
			<a href="https://ericdaat.github.io/tag/api.html" rel="tag">api</a>
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>As a big fan of Classic Rock living in France, I am very frustrated by the lack of good classic rock radio we have. I spent four months in St Louis, MO, and I had the chance to listen to <a href="http://www.kshe95.com/">KSHE 95</a> every day, playing some of my favorite classic rock tunes. Unfortunately, I can't listen to this radio in France as they block it. Fortunately, their website shows the <a href="http://player.listenlive.co/20101/en/songhistory">songs that have been playing earlier</a>. I decided to scrap this page, make myself an empty <a href="https://open.spotify.com/user/ericda/playlist/3BCcE8T945z1MnfPWkFsfX">Spotify playlist</a>, and automatically add in the KSHE tracks.</p>
<p>So far, I am able to:</p>
<ul>
<li>Scrap KSHE's web page, and get a list of 10 songs they've played</li>
<li>Find the songs on Spotify thanks to their web API</li>
<li>Upload them to a playlist I created, making sure there is no duplicate</li>
</ul>
<p>My next steps include:</p>
<ul>
<li>Automate this with a cron (or use something smarter like <a href="https://airflow.incubator.apache.org/">Airflow</a>) so the playlist keeps getting updated</li>
<li>Pull some stats about what's playing, and when, trying to predict the next song, or mood, who knows what ...</li>
</ul>
<p>Feel free to ping me if you want to help. You can have a look at the code on my <a href="https://github.com/ericdaat/kshe-to-spotify">Github repository</a>.</p>
<h1>Scraping KSHE 95 song history</h1>
<p>If you visit <a href="http://player.listenlive.co/20101/en/songhistory">KSHE 95 song history page</a>, you'll find a list of the 10 previously played songs. </p>
<p><img src="/images/kshe-song-history.png" width=400/></p>
<p>By inspecting the page using your favorite browser, you should see the list of these songs within a Javascript variable. </p>
<p><img src="/images/kshe-song-history-source.png" width=600px/></p>
<p>I am very new to webscraping, but Python libraries like <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">Beautiful Soup</a> make this really easy and straightforward. I just had to write the following lines to get the song list I wanted.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>

<span class="k">def</span> <span class="nf">get_song_history</span><span class="p">(</span><span class="n">player_url</span><span class="p">):</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">player_url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="n">song_history</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;songHistory&#39;</span><span class="p">]})</span>
    <span class="n">song_history_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
        <span class="n">song_history</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;var songs = &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">song_history_json</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">song_history_json</span>

<span class="n">song_history</span> <span class="o">=</span> <span class="n">get_song_history</span><span class="p">(</span><span class="s1">&#39;http://player.listenlive.co/20101/en/songhistory&#39;</span><span class="p">)</span>
</pre></div>


<p>This would return a json that looks like the following.</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;JOURNEY&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502900650000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;LOVIN&#39;,TOUCHIN&#39;/CITY OF THE ANGELS&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;DOORS&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502901058000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;BREAK ON THROUGH&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;VAN HALEN&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502901792000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;JUMP&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;JOE WALSH&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502902038000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;LIFE&#39;S BEEN GOOD&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;SOUNDGARDEN&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502902593000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;SPOONMAN&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;STYX&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502903312000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;COME SAIL AWAY&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;CHEAP TRICK&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502903798000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;LONG TIME COMING&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;DEF LEPPARD&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502903995000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;BRINGIN&#39; ON THE HEARTBREAK&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;BLACK SABBATH&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502904272000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;PARANOID&quot;</span>
  <span class="p">},</span> 
  <span class="p">{</span>
    <span class="nt">&quot;artist&quot;</span><span class="p">:</span> <span class="s2">&quot;MONTROSE&quot;</span><span class="p">,</span> 
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mi">1502904437000</span><span class="p">,</span> 
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;ROCK CANDY&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>


<h1>Uploading the songs to a Spotify Playlist</h1>
<p>During this part, we are going to use the <a href="https://developer.spotify.com/web-api/">Spotify Web API</a>. I found the API very straightforward and easy to deal with. The documentation is clear and they show a lot of examples that help. You will need to setup a Developer account and register an Application. This will provide you credentials that you will need for the rest of this post.</p>
<p>Note: There exists a Python library called <a href="https://spotipy.readthedocs.io/en/latest/">Spotipy</a> to deal with the Spotify API. While this library is very complete and super easy to use, I wanted to code my application from scratch and follow the Spotify API documentation. It may take more time, but it's good fun.</p>
<h2>Authorization</h2>
<p>I had some trouble figuring this part at first, but it's not that big of a deal once you understand the logic behind it. The <a href="https://developer.spotify.com/web-api/authorization-guide/">Spotify documentation</a> explains it really well, but I will do a little recap here. There is basically three ways you can authenticate, which will give you an access token you will send within your HTTP requests. I only tried two out of three:</p>
<ul>
<li>Authorization Code Flow: will give you a user access token that will enable you to retrieve some personal informations, as well as modifying your playlists, library, etc ...</li>
<li>Client Credentials: will only let you retrieve public informations about artists, tracks, albums, but nothing involving user's data.</li>
</ul>
<p>For our purpose, we will need <em>Authorization Code Flow</em> because we want to modify our own playlist. Let's see how we do this. The following picture taken from Spotify documentation explains it well how the authorization code flow works. </p>
<p><img src="https://developer.spotify.com/wp-content/uploads/2014/04/Authorization-Code-Flow-Diagram.png" width=600px/></p>
<p>What happens is:</p>
<ul>
<li>We need a web application (can run on <em>localhost</em>) from where we will send an authentication request, using a simple HTTP <em>GET</em> method along with some credentials and a <em>redirect-uri</em> (our web application's url).</li>
<li>Spotify will prompt the user to login, and will redirect to the <em>redirect-uri</em> we passed along with an <em>authorization-code</em> within the request. </li>
<li>We exchange this code we received to a token using an HTTP <em>POST</em> request.</li>
<li>From now on, we can use the Spotify API with this token we stored. It will be valid for 3600 seconds and can be refreshed when needed.</li>
</ul>
<p>To do this, I used the two functions below within a Flask application.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_authorization_code_flow_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Builds the URL to redirect to in order to show the login form</span>
<span class="sd">    Returns a URL string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;https://accounts.spotify.com/authorize?{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">urlencode</span><span class="p">({</span>
            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_id</span><span class="p">,</span>
            <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
            <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;playlist-modify-public playlist-modify-private&#39;</span><span class="p">,</span>
            <span class="s1">&#39;show_dialog&#39;</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}))</span>

<span class="k">def</span> <span class="nf">_client_credentials_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">authorization_code</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Exhanges an authorization code to an access token</span>
<span class="sd">    Returns a json response containing the token along with other informations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">auth_header</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
        <span class="s1">&#39;{0}:{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_secret</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s1">&#39;https://accounts.spotify.com/api/token&#39;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Basic {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auth_header</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))},</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span><span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">authorization_code</span><span class="p">,</span>
            <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">redirect_uri</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;playlist-modify-public playlist-modify-private&#39;</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>


<p>And the Flask app code is the following:</p>
<div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/auth&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auth</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Redirects to the Spotify login form</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">_authorization_code_flow_authentication</span><span class="p">())</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">callback</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Called by the Spotify API if login is succesful, exchanges</span>
<span class="sd">    authorization code in favor of an access token.</span>
<span class="sd">    Returns a json response containing the access token so </span>
<span class="sd">    we can store it within our application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">_client_credentials_authentication</span><span class="p">(</span>
            <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">],</span>
            <span class="n">api</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">)</span>

    <span class="n">api</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
    <span class="n">token_type</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;token_type&quot;</span><span class="p">]</span>
    <span class="n">api</span><span class="o">.</span><span class="n">_token_expires_in</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;expires_in&quot;</span><span class="p">]</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span>
            <span class="n">authenticated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">token_type</span><span class="o">=</span><span class="n">token_type</span><span class="p">,</span>
            <span class="n">token_expires_in</span><span class="o">=</span><span class="n">api</span><span class="o">.</span><span class="n">_token_expires_in</span>
        <span class="p">)</span>
</pre></div>


<p>My Flask application runs on <code>localhost:9999</code>. When I registered my Spotify Application, I specified the <em>redirect-uri</em> to be <code>http://localhost:9999/callback</code>. I start the authentication process by doing a <em>GET</em> request on <code>localhost:9999/auth</code> (I know, a <em>POST</em> would be cleaner) which redirects to the Spotify login form that then redirects back to <code>localhost:9999/callback</code> with the <em>authorization-code</em> so I can send the last request to exchange the <em>authorization-code</em>in favor of the token (phew!).</p>
<p>Note: The few lines code I showed above is just a snippet that won't work as is since I am using classes and all. Please have a look <a href="https://github.com/ericdaat/kshe-to-spotify/blob/master/flask-server/application/spotify_api.py">here</a> for the full Spotify API code, and <a href="https://github.com/ericdaat/kshe-to-spotify/blob/master/flask-server/application/app.py">here</a> for the full Flask API code.</p>
<h2>Searching for songs</h2>
<p>Now that we are authenticated, let's have some fun with the Spotify Web API.</p>
<p>Since we have the list of tracks we scraped from KSHE 95 website as a JSON, Python will use it as a list of dict. From this list, we can just iterate over each dict that contains the song name and artist and search for the song using Spotify API. We will be able to retrieve a lot of informations on the track, artist, album, etc ... We do this with the following function.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_name</span><span class="p">,</span> <span class="n">artist_name</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Searches for a song given its title and artist name</span>
<span class="sd">    Returns a dict containing informations on the song</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;https://api.spotify.com/v1/search&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;q&#39;</span><span class="p">:</span><span class="s1">&#39;artist:&quot;{0}&quot;%20track:&quot;{1}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">artist_name</span><span class="p">,</span> <span class="n">track_name</span><span class="p">),</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;track&#39;</span><span class="p">,</span>
                <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span>
            <span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">)}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;tracks&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">&#39;could not find track {0} from {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">track_name</span><span class="p">,</span> 
                <span class="n">artist_name</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;song_name&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="s1">&#39;artist_name&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;artists&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="s1">&#39;album_name&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;album&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="s1">&#39;popularity&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;popularity&#39;</span><span class="p">],</span>
        <span class="s1">&#39;duration_ms&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;duration_ms&#39;</span><span class="p">],</span>
        <span class="s1">&#39;explicit&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;explicit&#39;</span><span class="p">],</span>
        <span class="s1">&#39;spotify_uri&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;uri&#39;</span><span class="p">],</span>
        <span class="s1">&#39;album_image&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;album&#39;</span><span class="p">][</span><span class="s1">&#39;images&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
    <span class="p">}</span>
</pre></div>


<h2>Adding songs to playlist</h2>
<p>Now we simply take all the <em>spotify_uri</em> fields from the previous json, and call the following function that will update the playlist with our new songs. Note that this won't ignore duplicates. To do so, we will need to manually filter out the tracks that are already existing within the playlist.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_tracks_to_playlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_uris</span><span class="p">,</span> <span class="n">playlist_uri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds tracks to a playlist given a list of track uris and a playlist uri</span>
<span class="sd">    Returns a JSON response</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s1">&#39;https://api.spotify.com/v1/users/{0}/playlists/{1}/tracks&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_user_id</span><span class="p">,</span>
            <span class="n">playlist_uri</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">)},</span>
        <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;uris&#39;</span><span class="p">:</span> <span class="n">track_uris</span><span class="p">})</span>
    <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>


<p>And that's about it ! You can have a look at my Github repository for the full code. My playlist is public and available on Spotify <a href="https://open.spotify.com/user/ericda/playlist/3BCcE8T945z1MnfPWkFsfX">here</a>. Note that my application is not running on its own yet, which means the playlist is not uploaded regularly. I will look at it as soon as I can find some time. Meanwhile feel free to let me know if this was useful, or don't hesitate to ping me on Github if you want to help !</p>
<p><img src="/images/kshe-spotify-playlist.png" width=600px/></p></div>
	<hr>
    <!-- <h2>Comments</h2> -->
</div>
		</div>
	</div> 	<!-- <hr> -->
</div> <!-- /container -->
<footer class="aw-footer bg-danger">
	<div class="container"> <!-- footer -->
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-3">
						<h4>Navigation</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://ericdaat.github.io">Eric's Blog</a></li>
							<li><a href="https://ericdaat.github.io//archives.html"><i class="fa fa-Archives "></i> Archives</a></li>
							<li><a href="https://ericdaat.github.io//categories.html"><i class="fa fa-Categories "></i> Categories</a></li>
							<li><a href="https://ericdaat.github.io/pages/about-me.html"><i class="fa fa-About me "></i> About me</a></li>
							<li><a href="https://ericdaat.github.io/feeds/all.atom.xml" type="application/atom+xml"><i class="fa fa-rss "></i> atom</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Author</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://github.com/ericdaat">Github</a></li>
							<li><a href="https://twitter.com/ericdaoud">Twitter</a></li>
							<li><a href="https://www.youtube.com/user/ericmusic13">Youtube</a></li>
							<li><a href="https://www.linkedin.com/in/ericdaoud/">Linkedin</a></li>
							<li><a href="https://500px.com/ericda">500px</a></li>
						</ul>
					</div>
					<div class="col-md-3">
						<h4>Categories</h4>
						<ul class="list-unstyled my-list-style">
							<li><a href="https://ericdaat.github.io/category/photography.html">Photography (1)</a></li>
							<li><a href="https://ericdaat.github.io/category/programming.html">Programming (8)</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; Eric Daoud 2016</p>
			<p>Powered by Pelican</p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-105599779-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>